---
title: 【後端隨筆】關聯式資料庫
author: Martin
date: 2022-02-05T05:55:10.209+0000
last_modified_at: 2022-02-05T06:28:48.862+0000
categories: 
tags: []
description: 關聯式資料庫顧名思義，就是特別講究資料表與資料表之間關聯性的資料庫，再更清楚的話，其實是每筆資料與他比資料之間的關聯性。
image:
  path: assets/7cd3e45b38c4/1*-T8AKGc8C0_TuXdO6Qon_Q.png
render_with_liquid: false
---

### 【後端隨筆】關聯式資料庫

關聯式資料庫顧名思義，就是特別講究資料表與資料表之間關聯性的資料庫，再更清楚的話，其實是每筆資料與他比資料之間的關聯性。


![圖片來源：alphacamp](/assets/7cd3e45b38c4/1*-T8AKGc8C0_TuXdO6Qon_Q.png)

圖片來源：alphacamp

關連式資料庫除了 **資料之間有明確的關聯** 外，還有兩樣特質：
- **資料是以一個或是多個資料表 \(table\) 的方式存放** ：在關聯式資料庫裡，每一筆資料都是在資料表\(table\)中的一列資料\(record\)，然後再把不同的 table 集合起來，就成為一個關聯式資料庫。



![每一列都是一筆資料，圖片來源：alphacamp](/assets/7cd3e45b38c4/1*CBv021KPmKrsWU_qG90z0Q.png)

每一列都是一筆資料，圖片來源：alphacamp

所以使用關聯式資料庫的網站，背後都有多個資料表，分別紀錄不同的資料，每個資料表各自也有不同的關聯。例如一個餐廳論壇網站，最基本就會有使用者資料表、餐廳資料表、留言資料表、追蹤資料表等等
- **關聯式資料庫以SQL** \(Structured Query Language 結構化查詢語言\) **語言操作** ：SQL是一種以資料為主角去思考，專門用來管理與查詢關聯式資料庫的程式語言。透過 SQL，我們能在關聯式資料庫裡新增、查詢、更新和刪除資料，同時也能建立和修改資料庫模式。然而比起其他程式語言，SQL 仍稍嫌生硬，因此才會發展出對應的ORM\(Object Relational Mapping\)技術。

```
SELECT * FROM [TABLE_NAME] WHERE [COND];
```

上述這句SQL 的意思，就是「從 \[TABLE\_NAME\] 的資料表中取出滿足 \[COND\] 條件的資料。
#### 關聯

介紹完關連式資料庫的特色後，不可不提的就是資料間的關聯，而所謂的「關聯」，主要可分為三個種類：
- one\-to\-one：一對一：一筆資料 A 最多只會對應到一筆資料 B。
例如：餐廳論壇中，每個使用者只會有一筆最愛餐廳的清單。這裡指的是最愛清單而不是清單上的餐廳。
- one\-to\-many：一對多：一筆資料 A 會對應到多筆資料 B，但資料 B 反過來卻只會對應到一筆資料 A。
例如：餐廳論壇中，會有許多餐廳的分類，每一種分類下有許多餐廳，每一間餐廳只會屬於一種分類。
- many\-to\-many：多對多：一筆資料 A 會對應到多筆資料 B，而一筆資料 B 也會對應到多筆資料 A。
例如：餐廳論壇中，最愛清單上會有許多餐廳，每一間餐廳也可以同時被很多人的最愛清單列在上面。


要怎麼分別資料間的關聯性，最基本的思考方式，就是詢問在目前應用程式需求的情境下：資料 A 是否有多筆資料 B？資料 B 又是否有多筆資料 A？

根據資料間的關係，可以將資料庫內的資料表們概念雛形繪成實體關聯圖\(Entity Relationship Diagram，簡稱 ERD\)。再從關聯圖轉換成資料表


![實體關聯圖](/assets/7cd3e45b38c4/1*_ghYFme_uQLkfQGlCe8f_w.jpeg)

實體關聯圖


![更簡潔的實體關聯圖](/assets/7cd3e45b38c4/1*G-CD1gadGsjPLHYdpPuLzQ.jpeg)

更簡潔的實體關聯圖

從資料間的關聯性畫出實體關聯圖後，資料庫內的資料表們雛形也大概出來了，然而這種從上到下進行的分析（先找出實體，然後再分析實體之間的關聯性），難免會設計出一些未來較不好維護的資料表。此時就需要運用「資料庫正規化」的概念，由下而上地再次評估關聯表綱要是否符合正規化形式。
#### 正規化

正規化的特色有兩者：
- 去除重複性：建立沒有重複的關聯表，因為重複資料不只浪費資料庫的儲存空間，而且會產生資料維護上的問題。
例如：一張資料表內僅因一列當中的某個屬性不同，就重複產生高度類似的資料表，如下圖



![圖片來源：alphacamp](/assets/7cd3e45b38c4/1*uKYj2hQoVsHYlWYgqdS2Tg.png)

圖片來源：alphacamp
- 去除不一致的相依性：資料相依是指關聯表中的屬性之間擁有關係，如果關聯表擁有不一致的資料相依，這些屬性就會在新增、刪除或更新資料時，造成異常情況。


資料表正規化的步驟有三個階段：
- 第一階正規化型式（First Normal Form: 1NF）：在關聯表刪除多重值和複合屬性，讓關聯表只擁有單元值屬性。
- 第二階正規化型式（Second Normal Form: 2NF）：滿足 1NF 且 **所有的其他屬性都完全相依於主鍵** 
相依性 \(dependency\) 指的是 **知道 A 欄位的值就可以知道 B 欄位的值，稱作 B 欄位相依於 A 欄位** 。
- 第三階正規化型式（Third Normal Form: 3NF）：滿足 2NF，而且讓所有非主鍵屬性都只相依於該表的主鍵，而彼此之間互不相依。白話來說，如果這個欄位的資訊可以用其他欄位計算或推斷得出，就需要另外獨立成表來紀錄。



![未正規化](/assets/7cd3e45b38c4/1*TnaYusaF_Y1jCf4aJooxow.png)

未正規化


![第一階正規化，刪除多重值](/assets/7cd3e45b38c4/1*_TPoCIqlRod6FedKceqEgg.png)

第一階正規化，刪除多重值


![第二階正規化，所有的其他屬性都完全相依於主鍵](/assets/7cd3e45b38c4/1*VOKZEEgdztlgrF1sIOE-Aw.png)

第二階正規化，所有的其他屬性都完全相依於主鍵


![第三階正規化，讓所有非主鍵屬性都只相依於該表的主鍵](/assets/7cd3e45b38c4/1*vaea3z8Kz2ylio04FC8_Zw.png)

第三階正規化，讓所有非主鍵屬性都只相依於該表的主鍵

本文只是非常粗淺的介紹關聯式資料庫\(MySQL\)，但原生操作資料庫的SQL 或是衍伸的ORM\(Sequelize\) 技巧都需要在更多時間鑽研，因此未來有空在寫囉～




