---
title: 【後端隨筆】關於註冊、登入、登入那些小事
author: Martin
date: 2022-01-07T06:50:48.384+0000
last_modified_at: 2022-01-29T08:54:52.281+0000
categories: 
tags: []
description: 「註冊、登入、登出」這些功能我們早就用過不知道幾次了，不只在網路上、遊戲裡會用到，現實生活中也多得是運用的時候，例如：小時候每進到一間新的學校都要去註冊，交出自己的資料給管理者（校方），第一天上學時就類似登入，確認你是這所學校的學生，確認好（登入成功）就可以使用校方提供的功能（學…
image:
  path: assets/fb09b26345ba/1*CGdsjoDOxQLr-7FBvL84Gg.jpeg
render_with_liquid: false
---

### 【後端隨筆】關於註冊、登入、登出那些小事

「註冊、登入、登出」這些功能我們早就用過不知道幾次了，不只在網路上、遊戲裡會用到，現實生活中也多得是運用的時候，例如：小時候每進到一間新的學校都要去註冊，交出自己的資料給管理者（校方），第一天上學時就類似登入，確認你是這所學校的學生，確認好（登入成功）就可以使用校方提供的功能（學習、交友、談戀愛（？）），當你放學離開學校就可以想像成登出，沒辦法使用校方提供的功能，要等到隔天上學（再登入）才可以繼續使用功能。一樣的概念也可以套到去一家公司上班：註冊（入職填資料）、登入（上班進入公司）、登出（下班離開公司）。那在網路上又是怎樣運行的呢？


> 註冊 






![](/assets/fb09b26345ba/1*CGdsjoDOxQLr-7FBvL84Gg.jpeg)

1. 使用者點填寫完註冊表單擊註冊按鈕\(users/register\)，瀏覽器送出請求\(request\)給伺服器
2. 伺服器先驗證表單內容，檢查是否所有必填項目都填寫了、密碼是否輸入一致、註冊信箱是否已經被使用過
3. 如果上述有任一驗證沒通過，伺服器會給瀏覽器「導回註冊頁」的回應\(response\)
4. 如果驗證都通過，則會拿著這份資料去資料庫建一個使用者
5. 資料庫回報結果，如果沒出錯伺服器會給瀏覽器「導回首頁」的回應



> 登入 






![](/assets/fb09b26345ba/1*Bqa2BFPNLRymy-8NNCqhDw.jpeg)

1. 使用者在首頁輸入信箱及密碼後，點擊登入按鈕\(users/login\)，發出登入的請求\(request\)。
2. 伺服器拿到請求後，拿著登入資料用驗證機制\(passport\.js\)跟資料庫比對，檢查登入的信箱是否註冊過、信箱註冊過但密碼是否相符
3. 如果信箱未註冊過或密碼不符的話，伺服器會根據驗證結果給瀏覽器錯誤訊息\(flash message\)並「導回登入頁」的回應\(response\)
4. 如果驗證通過，伺服器會從資料庫內拿到使用者的資料\(序列化\)，將使用者的資料存進伺服器的 session store 內，並產生一組 session id
（在這僅會拿使用者的id，以減輕資料量。等之後需要其他資料時，再透過反序列化用id 拿到整包使用者的資料）
5. 伺服器將session id 連同「導回首頁」的回應傳給瀏覽器，瀏覽器會將session id 存入瀏覽器內的 cookie
6. 上述步驟就完成登入手續，此時瀏覽器內的 cookie 存有 session id（憑證），即使之後瀏覽器要造訪其他需要登入權限的網頁，發出其他請求，而且請求是彼此獨立且唯一的，伺服器也可以透過瀏覽器的憑證而知道這個請求是通過驗證的



> 登出 






![](/assets/fb09b26345ba/1*IVjzho8mesHbW-QSz1nuHA.jpeg)

1. 使用者點擊登出按鈕\(users/logout\)，發出登出的請求
2. 伺服器接收到請求後，會從請求中找到cookie 內的session id，並把存放在伺服器session store內的session 移除
3. 伺服器會給瀏覽器「導回登入頁」的回應



_[Post](https://medium.com/@martin87713/%E5%BE%8C%E7%AB%AF%E9%9A%A8%E7%AD%86-%E9%97%9C%E6%96%BC%E8%A8%BB%E5%86%8A-%E7%99%BB%E5%85%A5-%E7%99%BB%E5%85%A5%E9%82%A3%E4%BA%9B%E5%B0%8F%E4%BA%8B-fb09b26345ba){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
