---
title: ã€JavaScriptç­†è¨˜ã€‘ç€è¦½å™¨ä¸­çš„Event Loop
author: Martin
date: 2023-03-09T09:44:54.527+0000
last_modified_at: 2023-03-17T09:32:54.842+0000
categories: 
tags: [javascript,event-loop,website]
description: æ¥µæ·ºèŠEvent Loopæ¦‚å¿µ
image:
  path: assets/4bc888171ad5/0*AS4iTVxGaKiVlVsp.jpg
render_with_liquid: false
---

### ã€JavaScriptç­†è¨˜ã€‘ç€è¦½å™¨ä¸­çš„Event Loop
#### æ¥µæ·ºèŠEvent Loopæ¦‚å¿µ

åœ¨å‰å¹´åº•é‚„åœ¨ACå­¸ç¨‹å¼æ™‚ï¼Œå°±æ›¾åˆæ¬¡æ¥è§¸ [event loopé€™å€‹æ¦‚å¿µ](../583fe5e6d450/) ï¼Œç•¶æ™‚çš„ç†è§£æ˜¯ï¼šç‚ºäº†è®“å–®ä¸€åŸ·è¡Œåºçš„JavaScriptä¸æœƒå› ç‚ºä¸€äº›å‡½å¼åŸ·è¡Œå¤ªä¹…ï¼Œè€Œå°è‡´ä½¿ç”¨è€…é«”é©—å¤ªå·®ï¼Œè¡ä¼¸å‡ºéåŒæ­¥åŸ·è¡Œçš„æ¦‚å¿µåŠè½å¯¦éåŒæ­¥çš„å¯¦ä½œâ€”event loopã€‚

ç•¶æ™‚çš„æˆ‘åªçŸ¥é“ç€è¦½å™¨ä¸­æœ‰ä¸€å€‹ä¸»åŸ·è¡Œç·’call stackï¼Œåœ¨åŸ·è¡Œå‡½å¼æ™‚æœƒå°‡å‡½å¼æ”¾é€²\(push\)stackä¸­ï¼ŒåŸ·è¡Œå‡½å¼è£¡çš„å…§å®¹ï¼Œç•¶Aå‡½å¼è£¡åœ¨å‘¼å«åˆ¥çš„å‡½å¼Bæ™‚ï¼Œæœƒå†æŠŠBå‡½å¼pushé€²stacké€²è€ŒåŸ·è¡ŒBå‡½å¼ã€‚ç•¶å‡½å¼åŸ·è¡Œå®Œ\(return\)å¾Œï¼Œå°±æœƒå°‡å‡½å¼ç§»å‡º\(pop\)stackã€‚
éç¨‹ä¸­é›£å…æœƒé‡åˆ°ä¸€äº›éåŒæ­¥çš„å‡½å¼ï¼Œé€™äº›éåŒæ­¥å‡½å¼æœƒäº¤çµ¦ç€è¦½å™¨çš„å…¶ä»–APIå€‘å»è™•ç†ã€‚è™•ç†å®Œä»¥å¾Œå°‡å‡½å¼æ”¾é€²ä»»å‹™ä½‡åˆ—\(task queue\)ï¼Œç­‰å¾…call stackä¸­çš„ç¨‹å¼éƒ½åŸ·è¡Œå®Œä»¥å¾Œï¼Œæ‰æœƒå°‡task queueä¸­çš„å‡½å¼æ”¾é€²call stackä¸­åŸ·è¡Œã€‚è©³ç´°èªªæ˜åŠéç¨‹å¯åƒè€ƒ [å½±ç‰‡](https://www.youtube.com/watch?time_continue=292&v=8aGhZQkoFbQ&embeds_widget_referrer=https%3A%2F%2Fmedium.com%2F%40martin87713%2Fjavascript%25E7%25AD%2586%25E8%25A8%2598-what-is-event-loop-583fe5e6d450&embeds_euri=https%3A%2F%2Fcdn.embedly.com%2F&embeds_origin=https%3A%2F%2Fcdn.embedly.com&source_ve_path=MTM5MTE3&feature=emb_logo){:target="_blank"}
#### æ·ºèŠEvent Loopæ¦‚å¿µ

éš¨è‘—æˆ‘è½‰è·æˆå¾Œç«¯å·¥ç¨‹å¸«å¾Œæ¥è§¸è¶Šä¾†è¶Šå¤šç¨‹å¼ï¼Œæ¼¸æ¼¸ç™¼ç¾ç•¶åˆå°event loopçš„äº†è§£æ˜¯å¤šéº¼çš„ç²—æ·ºä¹Ÿä¸æ­£ç¢ºï¼Œé€²è€Œèˆˆèµ·æ¢ç´¢event loopçš„æƒ³æ³•ã€‚ç„¶è€Œç•¶æˆ‘å˜—è©¦æŒ–æ˜æ›´å¤ševent loopçš„æ¦‚å¿µå¾Œï¼Œç™¼ç¾é€™æ ¹æœ¬æ˜¯å€‹è¶…ç´šå¤§å‘orzï¼Œä»¥æˆ‘ç¾åœ¨çš„ç¨‹åº¦æƒ³å®Œå…¨äº†è§£event loopçš„æ¦‚å¿µé›–ç„¶ä¸æ˜¯å®Œå…¨ä¸å¯èƒ½ï¼Œä½†æˆæœ¬çœŸçš„å¤ªé«˜å¤ªé«˜äº†ï¼Œå› æ­¤æˆ‘æ±ºå®šå…ˆæ·ºæ·ºåœ°æŒ–ä¸€ä¸‹å°±å¥½ï¼Œ2å¹´å¾Œç­‰æˆ‘å­¸æœƒéœ¸æ°£\(æµ·è³Šæ¢—\)å†ä¾†å¥½å¥½å°ä»˜event loop\! ğŸ˜¤

å¾ä¸Šé¢çš„æ®µè½æˆ‘å€‘å¤§æ¦‚å¾—çŸ¥event loopæ˜¯æ€éº¼é‹è¡Œçš„ï¼Œç„¶è€ŒéåŒæ­¥å‡½å¼å½¼æ­¤é–“å…¶å¯¦ä¹Ÿæœ‰å€‹å„ªå…ˆåŸ·è¡Œçš„é †åºï¼Œå°±è®“æˆ‘å…ˆä¸Šä¸€å¼µçµ±æ•´åœ–å†å¨“å¨“é“ä¾†


![ä¾†æºä¸å¯è€ƒçš„æµç¨‹åœ–](/assets/4bc888171ad5/0*AS4iTVxGaKiVlVsp.jpg)

ä¾†æºä¸å¯è€ƒçš„æµç¨‹åœ–

é¦–å…ˆæ­£åä¸€ä»¶äº‹ï¼šcall stackæœ¬èº«ä¸æ˜¯ä¸€å€‹åŸ·è¡Œç·’\(thread\)ï¼Œå…©è€…åŸºæœ¬ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼Œå°±æˆ‘ç†è§£ä¾†èªªçš„è©±ï¼Œåœ¨JSé€™å–®åŸ·è¡Œç·’çš„ç¨‹å¼èªè¨€ä¸­ï¼Œæœ‰ä¸€å€‹è³‡æ–™çµæ§‹\(stack\)ç”¨ä¾†å­˜æ”¾åŸ·è¡Œä¸­çš„å‡½å¼ï¼Œé€™å°±æ˜¯call stackï¼Œåˆåexecution context stackã€‚æ—¢ç„¶æ˜¯stackçš„è³‡æ–™çµæ§‹ï¼Œå°±ç¬¦åˆå¾Œé€²å…ˆå‡º\(LIFO, Last In First Out\)çš„æ¨¡å¼ï¼Œä¹Ÿè·Ÿæˆ‘å€‘ä¸Šé¢æéçš„=>Aå‡½å¼å‘¼å«Bå‡½å¼ï¼ŒBå‡½å¼\(å¾Œé€²\)åŸ·è¡Œå®Œå¾Œæ¯”Aå‡½å¼å…ˆå‡ºstack


![ä¾†æºï¼š [https://ithelp\.ithome\.com\.tw/articles/10260433](https://ithelp.ithome.com.tw/articles/10260433){:target="_blank"}](/assets/4bc888171ad5/0*Jc8cbaETN9yQnyiD.png)

ä¾†æºï¼š [https://ithelp\.ithome\.com\.tw/articles/10260433](https://ithelp.ithome.com.tw/articles/10260433){:target="_blank"}


![ä¾†æºï¼š [https://ithelp\.ithome\.com\.tw/articles/10260433](https://ithelp.ithome.com.tw/articles/10260433){:target="_blank"}](/assets/4bc888171ad5/0*y31KZJrjHXTroShZ.png)

ä¾†æºï¼š [https://ithelp\.ithome\.com\.tw/articles/10260433](https://ithelp.ithome.com.tw/articles/10260433){:target="_blank"}

å†ä¾†æ˜¯äº†è§£éåŒæ­¥å‡½å¼åœ¨event loopæœ‰åˆ†ç‚ºå®ä»»å‹™\(macrotask\)åŠå¾®ä»»å‹™\(microtask\)ï¼Œç²—ç•¥ç†è§£çš„è©±microtaskéƒ½æ˜¯ç›¸å°éœ€è¦è¼ƒçŸ­æ™‚é–“å¯å®Œæˆçš„ä»»å‹™ï¼ŒåŒ…å«Promiseçš„resolveã€rejectã€thenã€catchä»¥åŠMutationObserverçš„callback functionï¼›
macrotaskå°±åŒ…å±±åŒ…æµ·ï¼Œæ¯”å¦‚ç•«é¢çš„æ¸²æŸ“ã€äº‹ä»¶è™•ç†å™¨\(clickã€keydownç­‰ç­‰\)ã€è¨ˆæ™‚å™¨\(setTimeoutã€setInterval\)â€¦â€¦ç­‰ç­‰ï¼Œå¯ç²—ç•¥ç†è§£ç‚ºç›¸å°è¼ƒèŠ±æ™‚é–“çš„ä»»å‹™

æœ‰äº†ä»¥ä¸Šå°ä»»å‹™çš„èªçŸ¥ä»¥å¾Œï¼Œå°±å¯ä»¥é€²å±•åˆ°ä»»å‹™ä½‡åˆ—\(task queue\)ï¼Œä»¥ä¸‹æ‰€è¬›çš„ä»»å‹™éƒ½æ˜¯macrotaskï¼Œmicrotaskä¸åœ¨é€™æ®µçš„æ¢è¨ç¯„åœã€‚
åœ¨æœ€ä¸€é–‹å§‹çš„ç†è§£ä¸­ï¼Œtask queueæ˜¯å­˜æ”¾web APIåŸ·è¡Œå®Œçš„å‡½å¼å¾Œçš„callbackï¼Œåƒæ˜¯setTimeoutç­‰å¾…å®Œå¾Œè¦åŸ·è¡Œçš„callback functionã€‚æœ€ä¸€é–‹å§‹çš„ç†è§£ä¸¦æ²’æœ‰éŒ¯ï¼Œåªæ˜¯è¼ƒç‚ºç²¾ç°¡ï¼Œå¯¦éš›ä¸Štask queueçš„æ•¸é‡æœ‰å¾ˆå¤šå€‹ï¼Œæ¯å€‹task queueéƒ½å­˜æ”¾ä¸€å€‹æˆ–å¤šå€‹ç‰¹å®šçš„taskï¼Œè€Œæ¯å€‹taskåˆæ˜¯ç”±ç‰¹å®šçš„ä»»å‹™æº\(task source\)è€Œä¾†\[é€™å°±æœ‰é»å¤ªæ·±äº†ï¼Œä¸‹æ¬¡å†æŒ–\]ã€‚
ç¸½çµï¼š event loopæœ‰ä¸åªä¸€å€‹task queueï¼Œæ¯å€‹task queueé‡å°ç‰¹å®šçš„ä»»å‹™å»å­˜æ”¾ï¼Œtask queueå­˜æ”¾çš„ä»»å‹™éƒ½æ˜¯macrotask

é‚£å‰›æåˆ°çš„microtaskå‘¢ï¼Ÿæœ‰æ²’æœ‰microtask queueï¼Ÿ
é‚„çœŸçš„æœ‰ï¼
ç„¶è€Œmicrotask queueè·Ÿå‰›æåˆ°çš„task queueæœ¬è³ªæ˜¯ä¸åŒçš„æ±è¥¿ï¼Œå…ˆä¸æ·±æŒ–ï¼Œåªè¦å…ˆçŸ¥é“microtask queueä¸æ˜¯ä»»å‹™ä½‡åˆ—\(task queue\)å°±å¥½


> _The [microtask queue](https://html.spec.whatwg.org/multipage/webappapis.html#microtask-queue){:target="_blank"} is not a [task queue](https://html.spec.whatwg.org/multipage/webappapis.html#task-queue){:target="_blank"} \._ 





> _Each [event loop](https://html.spec.whatwg.org/multipage/webappapis.html#event-loop){:target="_blank"} has a microtask queue, which is a [queue](https://infra.spec.whatwg.org/#queue){:target="_blank"} of [microtasks](https://html.spec.whatwg.org/multipage/webappapis.html#microtask){:target="_blank"} , initially empty\. A microtask is a colloquial way of referring to a [task](https://html.spec.whatwg.org/multipage/webappapis.html#concept-task){:target="_blank"} that was created via the [queue a microtask](https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask){:target="_blank"} algorithm\._ 





äº†è§£ä»»å‹™ã€ä»»å‹™ä½‡åˆ—å¾Œï¼Œæœ€å¾Œè¦å†å»ºç«‹ä¸€å€‹èªçŸ¥ï¼šç€è¦½å™¨ä¸­çš„event loopä¹Ÿä¸åªä¸€å€‹ï¼Œé‡å°ä¸åŒçš„web APIå¯åˆ†ç‚ºä¸‰é¡window event loopã€worker event loopã€worklet event loop\[é€™ä¹Ÿæœ‰é»å¤ªæ·±äº†ï¼Œä¸‹æ¬¡å†æŒ–\]


> The [event loop](https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop){:target="_blank"} of a [similar\-origin window agent](https://html.spec.whatwg.org/multipage/webappapis.html#similar-origin-window-agent){:target="_blank"} is known as a window event loop\. The [event loop](https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop){:target="_blank"} of a [dedicated worker agent](https://html.spec.whatwg.org/multipage/webappapis.html#dedicated-worker-agent){:target="_blank"} , [shared worker agent](https://html.spec.whatwg.org/multipage/webappapis.html#shared-worker-agent){:target="_blank"} , or [service worker agent](https://html.spec.whatwg.org/multipage/webappapis.html#service-worker-agent){:target="_blank"} is known as a worker event loop\. And the [event loop](https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop){:target="_blank"} of a [worklet agent](https://html.spec.whatwg.org/multipage/webappapis.html#worklet-agent){:target="_blank"} is known as a worklet event loop\. 





ç¸½çµï¼šç€è¦½å™¨å…±æœ‰ä¸‰å€‹event loopï¼Œæ¯å€‹event loopåº•ä¸‹æœ‰ä¸€å€‹æˆ–å¤šå€‹ä»»å‹™ä½‡åˆ—\(task queue\)ï¼Œæ¯å€‹task queueå°æ‡‰ä¸€å€‹æˆ–å¤šå€‹ç‰¹å®šå®ä»»å‹™\(macrotask\)ã€‚å¾®ä»»å‹™\(microtask\)ä¸åœ¨é€™ä¸‰å€‹event loopçš„ç¯„åœå…§ï¼Œå­˜æ”¾microtaskçš„å¾®ä»»å‹™ä½‡åˆ—\(microtask queue\)ä¸æ˜¯ä¸€å€‹task queue

äº†è§£å®Œevent loopæ©Ÿåˆ¶è£¡åƒèˆ‡çš„æ¯å€‹è…³è‰²å®šä½å¾Œï¼Œçµ‚æ–¼å¯ä»¥ä¾†èªªæ˜æ•´å€‹æ©Ÿåˆ¶
å…ˆå›åˆ°é‚£ä¸€å¼µåœ–


![](/assets/4bc888171ad5/0*lTtlQqIzQKxB6Atz.jpg)


æ•´å€‹æµç¨‹æ­£å¦‚åœ–ä¸­æ‰€æ¼”ç¤ºï¼Œç•¶event loopå­˜åœ¨ï¼Œå°±æœƒå…ˆå¾çœ¾å¤šmacrotask queue\(ä¹Ÿå°±æ˜¯task queue\)ä¸­æŒ‘å‡ºä¸€å€‹task queueï¼ŒæŒ‘é¸çš„æ©Ÿåˆ¶ç”±ç€è¦½å™¨\(user agent\)æ±ºå®šï¼ŒæŒ‘å‡ºtask queueå¾Œå†å¾task queuä¸­é¸å‡ºæœ€æ—©é€²å…¥queueçš„oldestTaskæ”¾å…¥call stackåŸ·è¡Œ\(queueæ˜¯å…ˆé€²å…ˆå‡ºFIFO, First\-In\-First\-Out\)ã€‚åŸ·è¡Œå®Œå¾Œæ–½è¡Œå¾®ä»»å‹™æª¢æŸ¥\( [Perform a microtask checkpoint](https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint){:target="_blank"} \)ï¼Œç•¶å¾®ä»»å‹™ä½‡åˆ—ä¸ç‚ºç©ºçš„è©±ï¼Œä¸€ç›´æ‹¿å‡ºä½‡åˆ—è£¡çš„å¾®ä»»å‹™ä¾†åŸ·è¡Œï¼Œä¹Ÿæ˜¯éµå¾ªå…ˆé€²å…ˆå‡ºçš„åŸå‰‡ã€‚è‡³æ–¼å¾®ä»»å‹™æª¢æŸ¥é€™æ©Ÿåˆ¶ä¹Ÿæ˜¯åè¤‡é›œ\[ä¸‹æ¬¡å†æŒ–orz\]ã€‚éƒ½åŸ·è¡Œå®Œå¾Œæª¢æŸ¥ç•«é¢æ˜¯å¦è¦æ¸²æŸ“\[é€™éƒ¨åˆ†çš„æ©Ÿåˆ¶ä¹Ÿæ˜¯ä¸‹æ¬¡å†æŒ–\]ã€‚è‡³æ­¤å°±æ˜¯ä¸€æ¬¡å®Œæ•´çš„event loopå¾ªç’°ï¼Œç•¶task queueä¸ç‚ºç©ºçš„è©±ï¼Œæœƒä¸€ç›´å¾ªç’°ä¸‹å»
æ•´å€‹å¾ªç’°æ¯ä¸€æ­¥åšç”šéº¼å¯ä»¥åƒè€ƒ [é€™ç¯‡æ–‡ç« ](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/){:target="_blank"} çš„ç¯„ä¾‹ï¼Œéå¸¸éˆå‹•ï¼

ä»¥ä¸Šå°±æ˜¯æ·ºèŠevent loopçš„éƒ¨åˆ†ï¼Œå¾…ä¸‹æ¬¡å†ä¾†æ·±æŒ–event loopï¼

åƒè€ƒæ–‡ä»¶


[![](/og-default.png)](https://yeefun.github.io/event-loop-in-depth/#%E5%BE%AE%E4%BB%BB%E5%8B%99%E7%9A%84%E5%9F%B7%E8%A1%8C%E7%AD%96%E7%95%A5){:target="_blank"}


[https://jakearchibald\.com/2015/tasks\-microtasks\-queues\-and\-schedules/](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/){:target="_blank"}



_[Post](https://medium.com/@martin87713/javascript%E7%AD%86%E8%A8%98-%E7%80%8F%E8%A6%BD%E5%99%A8%E4%B8%AD%E7%9A%84event-loop-4bc888171ad5){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
